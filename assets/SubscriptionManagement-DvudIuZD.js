import{u as S,a as C,r as o,j as e}from"./index-BnT946GU.js";import{B as n}from"./button-B6LXQo29.js";import{p as l}from"./paymentService-CEQw_n40.js";import{A as D}from"./arrow-left-BQRj5OLm.js";import{C as E}from"./circle-alert-CMFHS_dH.js";import{R as A}from"./refresh-cw-BD1r-FGP.js";import{C as P}from"./credit-card-B8x_2WPa.js";import{C as k}from"./calendar-yfexX3GG.js";import{C as M}from"./circle-check-big-CVmWcjJc.js";import"./promoCodeService-8OR0XIRB.js";import"./tslib.es6-De9GV7Vy.js";import"./balanceService-BrshoRSL.js";const K=()=>{const m=S(),{toast:i}=C(),[t,u]=o.useState(null),[f,j]=o.useState(!0),[g,x]=o.useState(!1),[N,h]=o.useState(!1),[c,d]=o.useState(!1);o.useEffect(()=>{const s=localStorage.getItem("user");if(s)try{const a=JSON.parse(s),r=l.getSubscriptionDetails(a.email);u(r),r||(i({title:"No Subscription Found",description:"You don't have an active subscription. Let's get you started!"}),m("/subscription"))}catch(a){console.error("Error loading subscription details:",a),i({title:"Error",description:"Failed to load subscription details",variant:"destructive"})}finally{j(!1)}else i({title:"Please Sign In",description:"You need to sign in to manage your subscription"}),m("/sign-in")},[]);const v=async()=>{d(!0);try{const s=localStorage.getItem("user");if(!s)throw new Error("User not found");const a=JSON.parse(s);if(await l.cancelSubscription(a.email)){const b=l.getSubscriptionDetails(a.email);u(b),x(!1),i({title:"Subscription Canceled",description:"Your subscription has been canceled. You'll still have access until the end of your billing period."})}else throw new Error("Failed to cancel subscription")}catch(s){console.error("Error canceling subscription:",s),i({title:"Error",description:s instanceof Error?s.message:"An error occurred while canceling your subscription",variant:"destructive"})}finally{d(!1)}},y=async()=>{d(!0);try{const s=localStorage.getItem("user");if(!s)throw new Error("User not found");const a=JSON.parse(s),r=await l.processPayment("annual",{method:"credit_card"});if(r.success&&r.subscriptionDetails)if(await l.verifyPayment(r.paymentId||""))if(l.saveSubscription(a.email,r.subscriptionDetails)){const w=l.getSubscriptionDetails(a.email);u(w),h(!1),i({title:"Subscription Upgraded",description:"Your subscription has been upgraded to the annual plan."})}else throw new Error("Failed to save subscription");else throw new Error("Payment verification failed");else throw new Error(r.error||"Payment failed")}catch(s){console.error("Error upgrading subscription:",s),i({title:"Error",description:s instanceof Error?s.message:"An error occurred while upgrading your subscription",variant:"destructive"})}finally{d(!1)}},p=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return f?e.jsxs("div",{className:"flex flex-col min-h-screen bg-white items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-2 border-blue-500 border-t-transparent"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading subscription details..."})]}):e.jsxs("div",{className:"flex flex-col min-h-screen bg-white",children:[e.jsxs("div",{className:"bg-white py-3 px-4 flex items-center justify-between border-b border-gray-200",children:[e.jsx("button",{onClick:()=>m("/profile"),className:"text-gray-600",children:e.jsx(D,{size:20})}),e.jsx("div",{className:"flex items-center",children:e.jsx("img",{src:"/lovable-uploads/600dca76-c989-40af-876f-bd95270e81fc.png",alt:"Shh",className:"h-6",style:{filter:"invert(30%) sepia(36%) saturate(1137%) hue-rotate(210deg) brightness(94%) contrast(85%)"}})}),e.jsx("div",{className:"w-5"})," "]}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Subscription Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage your premium subscription"})]}),t&&e.jsxs("div",{className:"px-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-5 text-white mb-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold mb-1",children:[t.plan==="annual"?"Annual":"Monthly"," Plan"]}),e.jsx("p",{className:"opacity-90",children:t.plan==="annual"?"$59.99 per year":"$7.99 per month"})]}),e.jsx("div",{className:`px-3 py-1 rounded-full text-sm ${t.status==="active"?"bg-green-500/20 text-white":"bg-yellow-500/20 text-white"}`,children:t.status==="active"?"Active":"Canceled"})]}),t.status==="canceled"&&e.jsxs("div",{className:"bg-white/20 p-3 rounded-lg mb-4 flex items-start",children:[e.jsx(E,{size:18,className:"mr-2 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm",children:"Your subscription has been canceled but will remain active until the end of the current billing period."})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Status:"}),e.jsx("span",{className:"font-medium",children:t.status==="active"?"Active":"Canceled"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Start Date:"}),e.jsx("span",{className:"font-medium",children:p(t.startDate)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Next Billing Date:"}),e.jsx("span",{className:"font-medium",children:p(t.endDate)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Auto-Renew:"}),e.jsx("span",{className:"font-medium",children:t.autoRenew?"Enabled":"Disabled"})]})]}),t.status==="active"&&e.jsxs("div",{className:"flex space-x-2",children:[t.plan==="monthly"&&e.jsxs(n,{onClick:()=>h(!0),className:"flex-1 bg-white text-blue-600 hover:bg-blue-50",children:[e.jsx(A,{size:16,className:"mr-1"}),"Upgrade to Annual"]}),e.jsx(n,{onClick:()=>x(!0),className:"flex-1 bg-white/20 text-white hover:bg-white/30",variant:"outline",children:"Cancel Subscription"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-5 mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold mb-3 flex items-center",children:[e.jsx(P,{size:18,className:"mr-2"}),"Payment Method"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-6 bg-gray-800 rounded mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"•••• •••• •••• 4242"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Expires 12/25"})]})]}),e.jsx(n,{variant:"ghost",size:"sm",children:"Change"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-5 mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold mb-3 flex items-center",children:[e.jsx(k,{size:18,className:"mr-2"}),"Billing History"]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.plan==="annual"?"Annual Plan":"Monthly Plan"}),e.jsx("p",{className:"text-xs text-gray-500",children:p(t.startDate)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium",children:t.plan==="annual"?"$59.99":"$7.99"}),e.jsxs("p",{className:"text-xs text-green-500 flex items-center",children:[e.jsx(M,{size:12,className:"mr-1"}),"Paid"]})]})]})})]})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-xl w-full max-w-md overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Cancel Subscription"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Are you sure you want to cancel your subscription? You'll still have access to premium features until the end of your current billing period."}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(n,{onClick:()=>x(!1),className:"flex-1",variant:"outline",disabled:c,children:"Keep Subscription"}),e.jsx(n,{onClick:v,className:"flex-1 bg-red-500 hover:bg-red-600",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Processing..."]}):"Yes, Cancel"})]})]})})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-xl w-full max-w-md overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Upgrade to Annual Plan"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Upgrade to our annual plan and save 37% compared to the monthly plan."}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-medium",children:"Monthly Plan"}),e.jsx("span",{children:"$7.99/month"})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-medium",children:"Annual Cost"}),e.jsx("span",{children:"$95.88/year"})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-blue-100",children:[e.jsx("span",{className:"font-medium",children:"Annual Plan"}),e.jsx("span",{className:"font-bold text-blue-600",children:"$59.99/year"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("span",{className:"font-medium",children:"You Save"}),e.jsx("span",{className:"font-bold text-green-600",children:"$35.89"})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(n,{onClick:()=>h(!1),className:"flex-1",variant:"outline",disabled:c,children:"Cancel"}),e.jsx(n,{onClick:y,className:"flex-1",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent mr-2"}),"Processing..."]}):"Upgrade Now"})]})]})})})]})};export{K as default};
//# sourceMappingURL=SubscriptionManagement-DvudIuZD.js.map
